<template>
    <div class="page" data-name="doctor-horarios-edit" id="doctor-horarios-edit">
        <div class="page-content">
            <div class="header">
                <div class="doc-horarios-add">
                    <a class="" href="/doctor/timetable/new">
                        <i class="material-icons">chevron_left</i>
                    </a>
                    <p class="title1">Editar horarios</p>
                </div>
            </div>
            <div class="list" id="cards">
                <ul>
                    <li id="lunes" class="accordion-item">
                        <div class="card card-outline doc-horarios days">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Lunes
                                <a class="item-link">
                                    <i class="material-icons">
                                        keyboard_arrow_down
                                    </i>
                                </a>
                            </div>
                            <div class="card-content card-content-padding">
                                <div class="accordion-item-content">
                                    <div class="row state">
                                        <p>Abierto</p>
                                        <label class="toggle toggle-init color-black">
                                            <input type="checkbox" checked>
                                            <span class="toggle-icon"></span>
                                        </label>
                                    </div>
                                    <div class="list">
                                        <ul>
                                            <li class="row hora l1" id="1">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 08:00 - 13:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                            <li class="row hora l2" id="2">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 15:00 - 21:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="new_horario row" href="">
                                        <i class="material-icons">add_circle</i>
                                        <p>Agregar horario</p>
                                    </a>
                                </div>
                                <div class="resume">
                                    <p id="r1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="r2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="martes" class="accordion-item">
                        <div class="card card-outline doc-horarios days">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Martes
                                <a class="item-link">
                                    <i class="material-icons">
                                        keyboard_arrow_down
                                    </i>
                                </a>
                            </div>
                            <div class="card-content card-content-padding">
                                <div class="accordion-item-content">
                                    <div class="row state">
                                        <p>Abierto</p>
                                        <label class="toggle toggle-init color-black">
                                            <input type="checkbox" checked>
                                            <span class="toggle-icon"></span>
                                        </label>
                                    </div>
                                    <div class="list">
                                        <ul>
                                            <li class="row hora l1" id="1">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 08:00 - 13:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                            <li class="row hora l2" id="2">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 15:00 - 21:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="new_horario row" href="">
                                        <i class="material-icons">add_circle</i>
                                        <p>Agregar horario</p>
                                    </a>
                                </div>
                                <div class="resume">
                                    <p id="r1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="r2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="miercoles" class="accordion-item">
                        <div class="card card-outline doc-horarios days">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Miercoles
                                <a class="item-link">
                                    <i class="material-icons">
                                        keyboard_arrow_down
                                    </i>
                                </a>
                            </div>
                            <div class="card-content card-content-padding">
                                <div class="accordion-item-content">
                                    <div class="row state">
                                        <p>Abierto</p>
                                        <label class="toggle toggle-init color-black">
                                            <input type="checkbox" checked>
                                            <span class="toggle-icon"></span>
                                        </label>
                                    </div>
                                    <div class="list">
                                        <ul>
                                            <li class="row hora l1" id="1">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 08:00 - 13:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                            <li class="row hora l2" id="2">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 15:00 - 21:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="new_horario row" href="">
                                        <i class="material-icons">add_circle</i>
                                        <p>Agregar horario</p>
                                    </a>
                                </div>
                                <div class="resume">
                                    <p id="r1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="r2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="jueves" class="accordion-item">
                        <div class="card card-outline doc-horarios days">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Jueves
                                <a class="item-link">
                                    <i class="material-icons">
                                        keyboard_arrow_down
                                    </i>
                                </a>
                            </div>
                            <div class="card-content card-content-padding">
                                <div class="accordion-item-content">
                                    <div class="row state">
                                        <p>Abierto</p>
                                        <label class="toggle toggle-init color-black">
                                            <input type="checkbox" checked>
                                            <span class="toggle-icon"></span>
                                        </label>
                                    </div>
                                    <div class="list">
                                        <ul>
                                            <li class="row hora l1" id="1">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 08:00 - 13:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                            <li class="row hora l2" id="2">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 15:00 - 21:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="new_horario row" href="">
                                        <i class="material-icons">add_circle</i>
                                        <p>Agregar horario</p>
                                    </a>
                                </div>
                                <div class="resume">
                                    <p id="r1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="r2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="viernes" class="accordion-item">
                        <div class="card card-outline doc-horarios days">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Viernes
                                <a class="item-link">
                                    <i class="material-icons">
                                        keyboard_arrow_down
                                    </i>
                                </a>
                            </div>
                            <div class="card-content card-content-padding">
                                <div class="accordion-item-content">
                                    <div class="row state">
                                        <p>Abierto</p>
                                        <label class="toggle toggle-init color-black">
                                            <input type="checkbox" checked>
                                            <span class="toggle-icon"></span>
                                        </label>
                                    </div>
                                    <div class="list">
                                        <ul>
                                            <li class="row hora l1" id="1">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 08:00 - 13:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                            <li class="row hora l2" id="2">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 15:00 - 21:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="new_horario row" href="">
                                        <i class="material-icons">add_circle</i>
                                        <p>Agregar horario</p>
                                    </a>
                                </div>
                                <div class="resume">
                                    <p id="r1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="r2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="sabado" class="accordion-item">
                        <div class="card card-outline doc-horarios days">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Sabado
                                <a class="item-link">
                                    <i class="material-icons">
                                        keyboard_arrow_down
                                    </i>
                                </a>
                            </div>
                            <div class="card-content card-content-padding">
                                <div class="accordion-item-content">
                                    <div class="row state">
                                        <p>Abierto</p>
                                        <label class="toggle toggle-init color-black">
                                            <input type="checkbox" checked>
                                            <span class="toggle-icon"></span>
                                        </label>
                                    </div>
                                    <div class="list">
                                        <ul>
                                            <li class="row hora l1" id="1">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 08:00 - 13:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                            <li class="row hora l2" id="2">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 15:00 - 21:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="new_horario row" href="">
                                        <i class="material-icons">add_circle</i>
                                        <p>Agregar horario</p>
                                    </a>
                                </div>
                                <div class="resume">
                                    <p id="r1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="r2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="domingo" class="accordion-item">
                        <div class="card card-outline doc-horarios days">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Domingo
                                <a class="item-link">
                                    <i class="material-icons">
                                        keyboard_arrow_down
                                    </i>
                                </a>
                            </div>
                            <div class="card-content card-content-padding">
                                <div class="accordion-item-content">
                                    <div class="row state">
                                        <p>Abierto</p>
                                        <label class="toggle toggle-init color-black">
                                            <input type="checkbox" checked>
                                            <span class="toggle-icon"></span>
                                        </label>
                                    </div>
                                    <div class="list">
                                        <ul>
                                            <li class="row hora l1" id="1">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 08:00 - 13:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                            <li class="row hora l2" id="2">
                                                <a class="close">
                                                    <i class="material-icons">
                                                        close
                                                    </i>
                                                </a>
                                                <p class="popup_open" data-popup=".edit-timetable"> 15:00 - 21:00 </p>
                                                <a class="edit popup_open" data-popup=".edit-timetable">
                                                    <i class="material-icons">
                                                        chevron_right
                                                    </i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a class="new_horario row" href="">
                                        <i class="material-icons">add_circle</i>
                                        <p>Agregar horario</p>
                                    </a>
                                </div>
                                <div class="resume">
                                    <p id="r1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="r2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="row btn">
                <a href="#" class="item-link list-button btn-rounded last">
                    <p>Aceptar </p>
                    <i class="material-icons">chevron_right</i>
                </a>
            </div>
        </div>
        <div class="popup edit-timetable">
            <div class="row pop-header">
                <a class="link popup-close" href="#"><i class="material-icons">close</i></a>
            </div>
            <hr>
            <p class="pop-title">Tiempo</p>
            <div class="time">
                <p class="start-time">08:00</p>
                <p>&nbsp-&nbsp</p>
                <p class="end-time">13:00</p>
                <p>&nbsp(</p>
                <p class="total-time">5:00</p>
                <p>&nbsph)&nbsp</p>
            </div>
            <div class="time-selector">
                <div class="head">
                    <a class="in">Entrada</a>
                    <a class="out">Salida</a>
                </div>
                <hr>
                <div class="body">
                    <div class="in-time active">
                        <input type="time" name="time-in" id="time-in" class="time-in" value="07:00" required validate>
                    </div>
                    <i class="material-icons">chevron_right</i>
                    <div class="out-time">
                        <input type="time" name="time-out" id="time-out" class="time-out" value="13:00" disabled
                            required validate>
                    </div>
                </div>
            </div>
            <div class="row btn">
                <a class="item-link list-button btn-rounded add">
                    <p>Aceptar </p>
                    <i class="material-icons">chevron_right</i>
                </a>
            </div>
        </div>
    </div>
</template>
<script>
    import $$ from 'dom7';
    export default {
        on: {
            pageInit: function(e, page) {
                var self = this;
                var app = self.$app;
                var new_x = false;
                var durhor, durmin, dow, nol, hours;
                var moment = require('moment');
                moment().format();

                app.data.store.getItem('horario-json').then(function(ele) {
                    ele.forEach(x => {
                        fillEdit(x);
                    });
                });

                //llenar datos ya guardarlos ********************

                //cuando la tarjeta se expande cambia la direccion de la flecha y esconde el resumen de horarios
                $$('.accordion-item').on('accordion:open', function() {
                    $$(this).find('.item-link').children('i').text('keyboard_arrow_up');
                    $$(this).find('.resume').css('display', 'none');
                });

                //cuando la tarjeta se contrae cambia la direccion de la flecha
                $$('.accordion-item').on('accordion:close', function() {
                    $$(this).find('.item-link').children('i').text('keyboard_arrow_down');
                    //si la tarjeta esta inactiva se queda escondido el resumen
                    if (!$$(this).children('.card').hasClass('inactive')) {
                        //si no lo vuelve a mostrar
                        $$(this).find('.resume').css('display', 'block');
                    }
                });

                //evento al abrir el pop up de horario
                $$('.edit-timetable').on('popup:open', function(e) {
                    let ti, to;
                    //checa si es nuevo horario o edicion
                    if (new_x) {
                        //da formato al input y lo pone en la linea de informacion de arriba
                        ti = moment($$(this).find('#time-in').val(), "hh:mm");
                        to = moment($$(this).find('#time-out').val(), "hh:mm");
                        $$('.start-time').text(ti.format("hh:mm"));
                        $$('.end-time').text(to.format("hh:mm"));
                    } else {
                        //cambia el valor del input por el que se tiene en la tajeta que se va a editar
                        $$(this).find('#time-in').val(hours[0]);
                        $$(this).find('#time-out').val(hours[1]);
                        //da formato al input
                        ti = moment($$(this).find('#time-in').val(), "hh:mm");
                        to = moment($$(this).find('#time-out').val(), "hh:mm");
                        //pone los valores en la linea de informacion
                        $$('.start-time').text(ti.format("hh:mm"));
                        $$('.end-time').text(to.format("hh:mm"));
                    }
                    //calcula las horas totales 
                    $$('.total-time').text(moment(to.diff(ti, 'minutes')).format('h:mm'));
                });

                //evento al cambiar la hora en el input
                $$('.time-selector input').change(function(val) {
                    //formato al los valores
                    let ti = moment($$('.edit-timetable').find('#time-in').val(), "hh:mm");
                    let to = moment($$('.edit-timetable').find('#time-out').val(), "hh:mm");
                    //cambia el valor en la linea de informacion
                    if ($$(this).hasClass('time-in')) {
                        $$('.start-time').text(ti.format("HH:mm"))
                    } else if ($$(this).hasClass('time-out')) {
                        $$('.end-time').text(to.format("HH:mm"))
                    }
                    //calcula la diferencia de horas y le da formato
                    durhor = moment.duration(to.diff(ti)).get('hours');
                    durmin = moment.duration(to.diff(ti)).get('minutes');
                    $$('.total-time').text(durhor + ':' + durmin);

                    //abilita o desabilita el boton
                    if (durhor <= 0 || !$$(this).val()) {
                        $$('.btn .add').addClass('grey');
                    } else {
                        $$('.btn .add').removeClass('grey');
                    }
                });

                //funcionamiento de botones entrada salida
                $$('.popup .head .in').click(function(x) {
                    $$('.popup .body .in-time').addClass('active');
                    $$('.popup .body .out-time').removeClass('active');
                    $$('.popup .body .out-time').children('input').prop('disabled', true);
                    $$('.popup .body .in-time').children('input').prop('disabled', false);
                });

                //funcionamiento de botones entrada salida
                $$('.popup .head .out').click(function(x) {
                    $$('.popup .body .out-time').addClass('active');
                    $$('.popup .body .in-time').removeClass('active');
                    $$('.popup .body .in-time').children('input').prop('disabled', true);
                    $$('.popup .body .out-time').children('input').prop('disabled', false);
                });

                //evento nuevo horario dentro de la tarjeta
                $$('.new_horario').click(function(x) {
                    //guarda dia de la semana
                    //varibale de nuevo horario
                    //crea pop op
                    //abre pop up
                    dow = $$(this).closest('li').attr('id');
                    new_x = true;
                    var popup = app.popup.create({
                        el: '.edit-timetable'
                    });
                    popup.open();
                });

                //cuando hace click en los horarios
                $$('.popup_open').click(function(x) {
                    //guarda el numero de linea
                    //guarda dia de la semana
                    //guarda horas de el horario
                    //guarda variable de edicion
                    //crea pop up y lo abre

                    nol = $$(this).closest('li').attr('id');
                    dow = $$(this).closest('.accordion-item').attr('id');
                    hours = $$(this).closest('li').children('p').text().split(' - ');
                    new_x = false;
                    var popup = app.popup.create({
                        el: '.edit-timetable'
                    });
                    popup.open();
                });

                //dehabilita doble click del boton
                $$('.btn .add').off('click');
                //evento click del boton
                $$('.btn .add').click(function(x) {
                    //si esta deshabilitado sale de la funcion
                    if ($$(this).hasClass('grey')) {
                        return;
                    }
                    //guarda hora de inicio y de fin
                    let st = $$(this).closest('.edit-timetable').find('.time-in').val();
                    let et = $$(this).closest('.edit-timetable').find('.time-out').val();
                    //si es nuevo crea una nueva linea 
                    if (new_x) {
                        let nid = parseInt($$('#' + dow + ' .list ul').children(':last-child').attr('id')) + 1;
                        if (isNaN(nid)) {
                            nid = 1;
                        }
                        $$('#' + dow + ' .list ul').append('<li class="row hora l' + y.id + '" id="' + nid + '">' +
                            '<a class="close">' +
                            '<i class="material-icons">' +
                            'close' +
                            '</i>' +
                            '</a>' +
                            '<p class="popup_open" data-popup=".edit-timetable"> ' + st + ' - ' + et + ' </p>' +
                            '<a class="edit popup_open" data-popup=".edit-timetable">' +
                            '<i class="material-icons">' +
                            'chevron_right' +
                            '</i>' +
                            '</a>' +
                            '</li>');
                        if (nid != 1) {
                            $$('#' + dow + ' .resume').append('<hr>');
                        }
                        $$('#' + dow + ' .resume').append('<p id="r' + nid + '"> ' + st + ' - ' + et + '</p>');

                    } else {
                        //si no edita la existenten
                        $$('#' + dow + ' .list ul').children('.l' + nol).find('p.popup_open').text(st + ' - ' + et);
                        $$('#' + dow + ' .resume').find('p#r' + nol).text(st + ' - ' + et);
                    }
                    new_x = false;
                    app.popup.close();
                    //si eliminan la hora lo quita bonito xD
                    $$('a.close').click(deleteHour);
                });
                //activa/deactiva horario
                $$('.toggle').change(function(val) {
                    var toggle = app.toggle.get($$(this));
                    if (!toggle.checked) {
                        $$(this).closest('.card').addClass('inactive');
                    } else {
                        $$(this).closest('.card').removeClass('inactive');

                    }
                });

                $$('.btn .last').click(function(x) {
                    //guarda datos
                    let json = [{}, {}, {}, {}, {}, {}, {}];
                    let cards = $$('#doctor-horarios-edit #cards ul').children('.accordion-item');
                    for (let i = 0; i < cards.length; i++) {
                        let card = cards[i];
                        json[i].nombre = $$(card).attr('id'); //dia
                        if (!$$(card).children('.card').hasClass('inactive')) { //activo 
                            json[i].activo = true;
                        } else {
                            json[i].activo = false;
                        }
                        json[i].horas = []; //horas
                        for (let j = 0; j < $$(card).find('ul').children().length; j++) {
                            let hour = $$(card).find('ul').children()[j];
                            json[i].horas.push({});
                            let arr = $$(hour).children('p').text().split(' - ');
                            json[i].horas[j].start = arr[0] + ':00.000';
                            json[i].horas[j].end = arr[1] + ':00.000';
                        }
                    }
                    //guarda datos y envia a la pagina anterior
                    app.data.store.setItem('horario-json', json).then(function(value) {
                        app.methods.redirectTo('doctor-horarios-add');
                    });
                });

                //si eliminan la hora lo quita bonito xD
                $$('a.close').click(deleteHour);

                function deleteHour() {
                    let tid = $$(this).closest('li').attr('id');
                    app.methods.cuteHide($$(this).closest('li'));
                    //quita del reumen
                    $$(this).closest('.card-content').children('.resume').children('p#r' + tid).prev().remove();
                    $$(this).closest('.card-content').children('.resume').children('p#r' + tid).remove();
                }

                function fillEdit(val) {
                    var toggle = app.toggle.get($$('#' + val.nombre + ' .card-content .toggle'));
                    if (val.activo) {
                        toggle.checked = true;
                        $$('#' + val.nombre + ' .card').closest('.card').removeClass('inactive');
                    } else {
                        toggle.checked = false;
                        $$('#' + val.nombre + ' .card').closest('.card').addClass('inactive');
                        $$('#' + val.nombre + ' .card').find('.resume').css('display', 'none');
                    }
                    $$('#' + val.nombre + ' .resume').empty();
                    $$('#' + val.nombre + ' .list ul').empty();
                    for (let i = 0; i < val.horas.length; i++) {
                        const y = val.horas[i];
                        let ArrST = y.start.split(":");
                        let ArrEt = y.end.split(":");
                        let st = ArrST[0] + ':' + ArrST[1];
                        let et = ArrEt[0] + ':' + ArrEt[1];

                        $$('#' + val.nombre + ' .list ul').append('<li class="row hora l' + y.id + '" id="' + y.id + '">' +
                            '<a class="close">' +
                            '<i class="material-icons">' +
                            'close' +
                            '</i>' +
                            '</a>' +
                            '<p class="popup_open" data-popup=".edit-timetable"> ' + st + ' - ' + et + ' </p>' +
                            '<a class="edit popup_open" data-popup=".edit-timetable">' +
                            '<i class="material-icons">' +
                            'chevron_right' +
                            '</i>' +
                            '</a>' +
                            '</li>'
                        );
                        if (i != 0) {
                            $$('#' + val.nombre + ' .resume').append('<hr>');
                        }
                        $$('#' + val.nombre + ' .resume').append('<p id="r' + y.id + '"> ' + st + ' - ' + et + '</p>');

                        $$('.popup_open').click(function(x) {
                            //guarda el numero de linea
                            //guarda dia de la semana
                            //guarda horas de el horario
                            //guarda variable de edicion
                            //crea pop up y lo abre
                            nol = $$(this).closest('li').attr('id');
                            dow = $$(this).closest('.accordion-item').attr('id');
                            hours = $$(this).closest('li').children('p').text().split(' - ');
                            new_x = false;
                            var popup = app.popup.create({
                                el: '.edit-timetable'
                            });
                            popup.open();
                        });
                    }
                }
            }
        }
    }
</script>