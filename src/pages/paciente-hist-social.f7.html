<template>
    <div class="page paciente-show-item" id="paciente-hist-social">
        <div class="header basic center fixed">
            <a class="back">
                <i class="material-icons">chevron_left</i>
            </a>
            <p class="title1">Historia Social</p>
            <a class="edit popover-open" data-popover=".popover-edit">
                <i class="material-icons">more_horiz</i>
            </a>
        </div>
        <div class="page-content">
            <div class="slot ocupacion">
                <p class="title">Ocupaci贸n</p>
                <p class="data"></p>
            </div>
            <div class="slot education">
                <p class="title">Educaci贸n</p>
                <p class="data"></p>
            </div>
            <div class="slot nacimiento">
                <p class="title">Lugar de nacimiento</p>
                <p class="data link"></p>
            </div>
            <div class="slot civil">
                <p class="title">Estado Civil</p>
                <p class="data"></p>
            </div>
            <div class="slot hijos">
                <p class="title">Hijos</p>
                <p class="data"></p>
            </div>
            <div class="slot sex">
                <p class="title">Orientaci贸n sexual</p>
                <p class="data"></p>
            </div>
            <div class="slot smoke">
                <p class="title">Fuma</p>
                <p class="data"></p>
            </div>
            <div class="slot alcohol">
                <p class="title">Alcohol</p>
                <p class="data"></p>
            </div>
            <div class="slot drugs">
                <p class="title">Sustancias</p>
                <p class="data"></p>
            </div>
            <div class="slot ejercicio">
                <p class="title">Ejercicio</p>
                <p class="data"></p>
            </div>
            <div class="slot stres">
                <p class="title">Estres</p>
                <p class="data"></p>
            </div>
            <div class="slot notes">
                <p class="title">Notas</p>
                <p class="data"></p>
                <!-- <p class="added">Agregada por: Dr. Bryan Thomas Gosling </p>
                <p class="date">19/02/2020 11:15 PM</p> -->
            </div>

        </div>
        <div class="popover popover-edit">
            <div class="popover-inner">
                <div class="list">
                    <ul>
                        <li><a class="list-button item-link edit" href="#">Editar</a></li>
                        <hr>
                        <li><a class="list-button item-link delete" href="#">Eliminar</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    import $$ from 'dom7';
    export default {
        on: {
            pageBeforeOut: function(e, page) {
                var self = this;
                var app = self.$app;
                if (e.detail.direction == 'backward') {
                    app.data.store.removeItem('hsocial_id');
                }
            },
            pageInit: function(e, page) {
                var self = this;
                var app = self.$app;

                app.preloader.show('blue');
                app.data.store.getItem('hsocial').then(function(value) {
                    var x = value;
                    $$(".slot.ocupacion .data").text(x.ocupacion);
                    $$(".slot.education .data").text(x.educacion);
                    $$(".slot.nacimiento .data").text(x.lugar_nacimiento);
                    $$(".slot.civil .data").text(x.estado_civil);
                    $$(".slot.hijos .data").text(x.hijos);
                    $$(".slot.sex .data").text(x.orientacion_sexual);
                    $$(".slot.smoke .data").text(x.fuma == true ? 'Si' : 'No');
                    $$(".slot.alcohol .data").text(x.alcohol == true ? 'Si' : 'No');
                    $$(".slot.drugs .data").text(x.sustancias);
                    $$(".slot.ejercicio .data").text(x.ejercicio);
                    $$(".slot.stres .data").text(x.estres);
                    $$(".slot.notes .data").text(x.notas);
                    app.preloader.hide();

                    $$('.popover-edit .item-link.edit').click(function(x) {
                        app.popover.close();
                        app.data.store.setItem('edit_patient_data', true).then(function(value) {
                            app.methods.redirectTo('paciente-hist-social-form');
                        });
                    });

                    $$('.popover-edit .item-link.delete').click(function(x) {
                        //cierra pop over
                        app.popover.close();
                        //crea cuadro de dialogo
                        var dialog = app.dialog.create({
                            cssClass: 'delete',
                            title: '<i class="material-icons">error</i>',
                            text: 'Esta seguro que desea eliminar?',
                            content: 'Esta operaci贸n es irreversible',
                            buttons: [{
                                text: '<p>Cancelar</p> <i class="material-icons">chevron_right</i>',
                                cssClass: 'cancel',
                                onClick:
                                //cancela la accion, cierra ventana
                                    function(x, y) {
                                    dialog.close();
                                    console.log('do not delete ');

                                }
                            }, {
                                text: '<p>Eliminar</p> <i class="material-icons">chevron_right</i>',
                                cssClass: 'delete',
                                onClick: function(x, y) {
                                    app.preloader.show('blue');
                                    app.data.store.getItem('patient_id').then(function(value) {
                                        var ptnt_id = value;
                                        app.request({
                                            url: app.data.url + '/pacientes/' + ptnt_id,
                                            method: "PUT",
                                            crossDomain: true,
                                            data: {
                                                "Historia_social": {}
                                            },
                                            success: function(e) {
                                                app.preloader.hide();
                                                app.methods.redirectTo('paciente-perfil');
                                            },
                                            error: function(e) {
                                                app.preloader.hide();
                                            }
                                        });
                                    });
                                }
                            }]
                        });
                        //abre cuadro de dialogo
                        dialog.open();
                    });
                });
            }
        }
    }
</script>