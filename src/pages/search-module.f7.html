<template>
    <div class="page" id="search-module">
        <div class="header">
            <div class="search info searchbar-hide-on-search">
                <a class="back">
                    <i class="material-icons">chevron_left</i>
                </a>
                <p class="title1"></p>
            </div>
            <form class="search-bar searchbar list">
                <ul>
                    <li class="item-content item-input">
                        <div class="item-inner">
                            <div class="item-input-wrap rounded">
                                <i class="icons material-icons">search</i>
                                <input type="search" id="search" placeholder="Search">
                                <span class="input-clear-button"></span>
                            </div>
                        </div>
                    </li>
                </ul>
            </form>
            <hr>
        </div>
        <div class="page-content">
            <div class="searchbar-backdrop"></div>
            <div class="list searchbar-found">
                <ul>
                </ul>
            </div>
            <div class="block searchbar-not-found">
                <div class="block-inner">Nothing found</div>
            </div>
        </div>

    </div>
</template>
<script>
    import $$ from 'dom7';

    export default {
        on: {
            pageInit: function(e, page) {
                var self = this;
                var app = self.$app;

                app.request.get(app.data.url + '/pacientes',
                    function(e) {
                        var x = JSON.parse(e);
                        for (let i = 0; i < x.length; i++) {
                            const ele = x[i];
                            let photo;
                            let direc = ele.direccion == null ? '' : ele.direccion;
                            if (ele.img_data != null) {
                                photo = '<img src="' + app.data.url + ele.img_data.url + '">';
                            } else {
                                photo = '<img src="../static/images/logo_v2.png" style="background: unset">';
                            }
                            $$('.searchbar-found ul').append(
                                '<li>' +
                                '<div class="card card-outline search patients">' +
                                '<div class="rectangle turquoise"></div>' +
                                '<div class="avatar">' +
                                photo +
                                '</div>' +
                                '<div class="card-content card-content-padding">' +
                                '<p class="dark-blue data" data-id="' + ele.id + '">' + ele.nombre + '</p>' +
                                '<p class="addr">' + direc + '</p>' +
                                '</div>' +
                                '</div>' +
                                '</li>'
                            );
                        }

                        var searchbar = app.searchbar.create({
                            el: '.searchbar',
                            searchContainer: '.searchbar-found',
                            searchIn: '.data',
                            on: {
                                search(sb, query, previousQuery) {}
                            }
                        });

                        app.data.store.getItem('search').then(function(value) {
                            if (value == 'patients_pagos') {
                                $$('#search-module .header .title1').text('Pacientes');
                                $$('.card.search').click(function(x) {
                                    let data = $$(this).find('.data').text(); //cambiar a ir
                                    let data_id = $$(this).find('.data').data('id');
                                    app.data.store.setItem('pago-patient-id', data_id);
                                    app.data.store.setItem('pago-patient', data).then(function(value) {
                                        app.data.store.removeItem('search');
                                        app.methods.redirectTo('doctor-agregar-pago');
                                    });
                                });
                            } else if (value == 'home_search_patients') {
                                $$('.card.search').click(function(x) {
                                    let id_p = $$(this).find('.data').data('id');
                                    console.log(id_p);
                                    app.data.store.setItem('search', true)
                                    app.data.store.setItem('patient_id', id_p).then(function(value) {
                                        app.methods.redirectTo('paciente-perfil');
                                    });
                                });
                            }
                        });
                    },
                    function(e) {}
                );
            }
        }
    }
</script>